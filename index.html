<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ISU EXCELLENCE AWARD Voting</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: Arial, sans-serif;
            background: #f5f5f5;
            padding: 20px;
        }
        .header {
            text-align: center;
            background: linear-gradient(135deg, #2c3e50, #34495e);
            color: white;
            padding: 30px;
            margin-bottom: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        .header h2 {
            font-size: 1.5em;
            opacity: 0.9;
        }
        .category-container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
            display: none;
        }
        .category-container.active {
            display: block;
        }
        .category-title {
            font-size: 1.8em;
            font-weight: bold;
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
        }
        .category-description {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        .candidates-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .candidate-option {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            border: 3px solid #e9ecef;
            transition: all 0.3s;
            cursor: pointer;
        }
        .candidate-option:hover {
            border-color: #3498db;
            background: #e3f2fd;
            transform: translateY(-3px);
        }
        .candidate-option.selected {
            border-color: #27ae60;
            background: #e8f5e8;
            box-shadow: 0 5px 15px rgba(39, 174, 96, 0.3);
            transform: translateY(-2px);
        }
        .candidate-photo {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid #3498db;
            margin-bottom: 12px;
            background: #ecf0f1;
        }
        .candidate-name {
            font-size: 1.1em;
            font-weight: bold;
            margin-bottom: 5px;
            color: #2c3e50;
        }
        .candidate-country {
            color: #7f8c8d;
            font-size: 0.9em;
            margin-bottom: 10px;
        }
        .navigation {
            display: flex;
            justify-content: space-between;
            margin-top: 30px;
        }
        .nav-btn {
            background: #3498db;
            color: white;
            padding: 12px 25px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s;
        }
        .nav-btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
        }
        .nav-btn:disabled {
            background: #bdc3c7;
            cursor: not-allowed;
            transform: none;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #ecf0f1;
            border-radius: 4px;
            margin-bottom: 20px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #27ae60, #2ecc71);
            border-radius: 4px;
            transition: width 0.3s;
        }
        .progress-text {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 10px;
            font-size: 0.9em;
        }
        .submit-section {
            text-align: center;
            margin: 30px 0;
            display: none;
        }
        .submit-section.active {
            display: block;
        }
        .submit-btn {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            padding: 18px 40px;
            border: none;
            border-radius: 8px;
            font-size: 1.2em;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(231, 76, 60, 0.4);
        }
        .instructions {
            text-align: center;
            color: #7f8c8d;
            margin-bottom: 20px;
            font-size: 1.1em;
        }
        /* ADMIN STYLES */
        .admin-section {
            text-align: center;
            margin: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
        }
        .admin-btn {
            background: #3498db;
            color: white;
            padding: 12px 20px;
            border: none;
            border-radius: 5px;
            margin: 5px;
            cursor: pointer;
            font-size: 14px;
        }
        .admin-btn:hover {
            background: #2980b9;
        }
        /* Deadline Banner */
        .deadline-banner {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
            text-align: center;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 10px;
            font-weight: bold;
            font-size: 1.1em;
            box-shadow: 0 4px 15px rgba(231, 76, 60, 0.3);
        }
        .deadline-banner.ended {
            background: linear-gradient(135deg, #7f8c8d, #95a5a6);
        }
        .deadline-banner.warning {
            background: linear-gradient(135deg, #f39c12, #e67e22);
        }
        /* Vote Results Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            overflow-y: auto;
        }
        .modal-content {
            background: white;
            margin: 50px auto;
            padding: 30px;
            border-radius: 15px;
            max-width: 800px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            border-bottom: 2px solid #ecf0f1;
            padding-bottom: 15px;
        }
        .modal-title {
            font-size: 1.8em;
            color: #2c3e50;
            font-weight: bold;
        }
        .close-btn {
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2em;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .close-btn:hover {
            background: #c0392b;
        }
        .vote-results {
            margin-top: 20px;
        }
        .vote-category {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 5px solid #3498db;
        }
        .vote-category-title {
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.1em;
        }
        .vote-candidate {
            background: white;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 5px 0;
            border: 1px solid #e9ecef;
        }
        .vote-candidate.winner {
            background: #e8f5e8;
            border-color: #27ae60;
            font-weight: bold;
        }
        /* Already Voted Message */
        .already-voted {
            text-align: center;
            background: #e8f5e8;
            padding: 30px;
            border-radius: 15px;
            margin: 20px 0;
            border: 3px solid #27ae60;
        }
        .already-voted h3 {
            color: #27ae60;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <!-- Deadline Banner -->
    <div class="deadline-banner" id="deadlineBanner">
        ‚è∞ Voting Ends: <span id="deadlineText"></span>
    </div>

    <div class="header">
        <h1>ISU EXCELLENCE AWARD</h1>
        <h2>Category-Based Voting System</h2>
    </div>

    <div class="instructions">
        <p>Vote for ONE candidate in each category. Navigate through categories using Next/Previous buttons.</p>
        <p style="color: #e74c3c; font-weight: bold;">‚ö†Ô∏è You can only vote once per device!</p>
    </div>

    <!-- Already Voted Message -->
    <div class="already-voted" id="alreadyVotedMessage" style="display: none;">
        <h3>‚úÖ Thank You For Voting!</h3>
        <p>You have already submitted your votes. Each person can only vote once.</p>
        <p>Results will be announced after the voting deadline.</p>
    </div>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill" style="width: 0%"></div>
    </div>
    <div class="progress-text" id="progressText">Category 1 of 34</div>

    <div id="categoriesContainer">
        <!-- Categories will be loaded here one at a time -->
    </div>

    <div class="submit-section" id="submitSection">
        <button class="submit-btn" onclick="submitVotes()">Submit All Votes</button>
    </div>

    <!-- ADMIN SECTION -->
    <div class="admin-section">
        <h3>Admin Functions</h3>
        <button onclick="viewAllVotes()" class="admin-btn">üìä View All Votes</button>
        <button onclick="viewLiveResults()" class="admin-btn" style="background: #0f9d58;">üìà View Google Sheets</button>
        <button onclick="resetForNewVoter()" class="admin-btn" style="background: #9b59b6;">üîÑ New Voter</button>
        <button onclick="clearAllVotes()" class="admin-btn" style="background: #e74c3c;">üóëÔ∏è Clear All Votes</button>
        <button onclick="extendDeadline()" class="admin-btn" style="background: #f39c12;">‚è∞ Extend Deadline</button>
        <button onclick="viewVotingStats()" class="admin-btn" style="background: #8e44ad;">üìà Voting Stats</button>
    </div>

    <!-- Vote Results Modal -->
    <div class="modal" id="voteResultsModal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">üìä All Vote Results</div>
                <button class="close-btn" onclick="closeModal()">√ó</button>
            </div>
            <div class="vote-results" id="voteResultsContent">
                <!-- Vote results will be loaded here -->
            </div>
        </div>
    </div>

    <script>
        // Google Sheets configuration
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbws6RmxVDl0deQPMiTGDTt5sonrbyEcowObvS5qgxLGxAApTNWG5d5KEtyUbW9YO92y0Q/exec';

        // VOTING DEADLINE - 3 days from now
        const VOTING_DURATION_DAYS = 3;
        let VOTING_DEADLINE = new Date(Date.now() + VOTING_DURATION_DAYS * 24 * 60 * 60 * 1000).getTime();

        // Award categories (only categories with nominees)
        const awardCategories = [
            "ISU Executive Board Member of the Year",
            "Most Dedicated Volunteer",
            "Outstanding Cultural Event of the Year",
            "International Students Athletes of the Year (Football, Volleyball, Basketball)",
            "Art & Creative Award",
            "Best Teacher of the Year",
            "Most Talented Award",
            "Most Popular Award (Male)",
            "Most Popular Award (Female)",
            "Most Active Award",
            "Best Behavior Award",
            "Best Cleaning Room Award",
            "Best Coach Award",
            "Best Student dancing Award",
            "Best Photographer award",
            "Student MC of the Year",
            "Best Course REP of the Year (Male)",
            "Best Course REP of the Year (Female)",
            "Best Artist of the Year",
            "Student Entrepreneur of the year",
            "Outstanding graphic designer of the year",
            "Gentlemen of the Year",
            "Lady of the Year",
            "Most fashionable Student (Male)",
            "Most fashionable Student (Female)",
            "Social Media Influencer of the year",
            "Most influential Student of the Year",
            "Best sports personality of the year",
            "Best Student in Politics of the year",
            "Best ISU appointees",
            "ISU Excellent Award",
            "Most influential personality of Football, Basketball, and volleyball",
            "Class Football Team of the year",
            "Committee/ Department Head of the year",
            "Best Initiative Award",
            "Academic Excellent Award (Undergraduate)",
            "Academic Excellent Award (Graduate)",
            "International Office Appreciation Award"
        ];

        // Candidate data with ALL nominees
        const candidates = [
            { name: "EL-KHADIRI MERYEME", country: "Morocco", photo: "photos/EL-KHADIRI_MERYEME.jpg", positions: [0,8,17,20,30,35,37] },
            { name: "Michelle Okyerebea Asante", country: "GHANA", photo: "photos/Michelle_Okyerebea_Asante.jpg", positions: [1,8,9,10,11,19,22,25] },
            { name: "Kundayi Nigel Ndoro", country: "ZIMBABWE", photo: "photos/Kundayi_Nigel_Ndoro.jpg", positions: [12,27,31] },
            { name: "BERRADA SOUHAIL", country: "MOROCCO", photo: "photos/BERRADA_SOUHAIL.jpg", positions: [15,21,23] },
            { name: "NIGINA", country: "UZBEKISTAN", photo: "photos/NIGINA.jpg", positions: [6,8,10,24,25] },
            { name: "Zulfiddin Mehriddinov", country: "UZBEKISTAN", photo: "photos/Zulfiddin_Mehriddinov.jpg", positions: [3,31] },
            { name: "MUHAMMADOV MUHAMMAD SODIK", country: "UZBEKISTAN", photo: "photos/MUHAMMADOV_MUHAMMAD_SODIK.jpg", positions: [27,31] },
            { name: "Diaby Khadjaly", country: "GUINEA", photo: "photos/Diaby_Khadjaly.jpg", positions: [14,20,21,30] },
            { name: "Wisdom Chisom", country: "Nigeria", photo: "photos/Wisdom_Chisom.jpg", positions: [23] },
            { name: "Kra Kouassi Fedi", country: "Ivory Coast", photo: "photos/Kra_Kouassi_Fedi.jpg", positions: [31] },
            { name: "Izzatullaev Musulmon", country: "UZBEKISTAN", photo: "photos/Izzatullaev_Musulmon.jpg", positions: [1,9,10] },
            { name: "Watson Karanda", country: "ZIMBABWE", photo: "photos/Watson_Karanda.jpg", positions: [19] },
            { name: "Eze Victor", country: "Nigeria", photo: "photos/Eze_Victor.jpg", positions: [19,23] },
            { name: "Keita Fatumata S", country: "Liberia", photo: "photos/Keita_Fatumata_S.jpg", positions: [15] },
            { name: "Elma Taimu", country: "Zimbabwe", photo: "photos/Elma_Taimu.jpg", positions: [13] },
            { name: "Marygold Vimbainashe", country: "ZIMBABWE", photo: "photos/Marygold_Vimbainashe.jpg", positions: [3,31] },
            { name: "Khoshimov M", country: "UZBEKISTAN", photo: "photos/Khoshimov_M.jpg", positions: [27,31] },
            { name: "Anika Jannatul Ferdush", country: "BANGLADESH", photo: "photos/Anika_Jannatul_Ferdush.jpg", positions: [1,2,8,9,11,13,22,26,30,34] },
            { name: "Serhani Anass", country: "MOROCCO", photo: "photos/Serhani_Anass.jpg", positions: [3,27,31] },
            { name: "Andrew Stephen W", country: "CAMEROON", photo: "photos/Andrew_Stephen_W.jpg", positions: [3,27,31] },
            { name: "Matola Kenny Jerre", country: "South Africa", photo: "photos/Matola_Kenny_Jerre.jpg", positions: [3] },
            { name: "Karshygayeva Aiym", country: "KAZAKHSTAN", photo: "photos/Karshygayeva_Aiym.jpg", positions: [6,8,26,36] },
            { name: "Chatir Soukaina", country: "MOROCCO", photo: "photos/Chatir_Soukaina.jpg", positions: [11,22,27,35] },
            { name: "Duru Valentine Obinna", country: "Nigeria", photo: "photos/Duru_Valentine_Obinna.jpg", positions: [7] },
            { name: "Say Kong Tharak", country: "CAMBODIA", photo: "photos/Say_Kong_Tharak.jpg", positions: [2,11] },
            { name: "Ork Chanchutema", country: "CAMBODIA", photo: "photos/Ork_Chanchutema.jpg", positions: [10,36] },
            { name: "Kong Mengsean", country: "CAMBODIA", photo: "photos/Kong_Mengsean.jpg", positions: [2,8,9,35,37] },
            { name: "Clarmancio Nilton Silva Fernandes", country: "Mozambique", photo: "photos/Clarmancio_Nilton_Silva_Fernandes.jpg", positions: [3,27] },
            { name: "Fixa", country: "MOROCCO", photo: "photos/Fixa.jpg", positions: [25] },
            { name: "MAMAYUSUPOV ILKHOM", country: "Uzbekistan", photo: "photos/MAMAYUSUPOV_ILKHOM.jpg", positions: [27,31] },
            { name: "Shaun Nkosinathi NG", country: "South Africa", photo: "photos/Shaun_Nkosinathi_NG.jpg", positions: [18] },
            { name: "AIT BAHMED FOUZIA", country: "MOROCCO", photo: "photos/AIT_BAHMED_FOUZIA.jpg", positions: [5,6,10,12,22,27,35] },
            { name: "LUPAHLA SANELE", country: "Zimbabwe", photo: "photos/LUPAHLA_SANELE.jpg", positions: [3,8,9,11,27] },
            { name: "OFFOR UCHECHI ROSELINE", country: "Nigeria", photo: "photos/OFFOR_UCHECHI_ROSE.jpg", positions: [11] },
            { name: "OUSSOUSS HAMID", country: "MOROCCO", photo: "photos/OUSSOUSS_HAMID.jpg", positions: [2,6,14] },
            { name: "SOT FA ELIN", country: "CAMBODIA", photo: "photos/SOT_FA_ELIN.jpg", positions: [0,4,9,11,14,20,25,28,30] },
            { name: "ORA", country: "Rwanda", photo: "photos/ORA.jpg", positions: [11] },
            { name: "PHIRI EMMANUEL", country: "Zambia", photo: "photos/PHIRI_EMMANUEL.jpg", positions: [1,10,33] },
            { name: "COMPUTER SCIENCE", country: "", photo: "photos/COMPUTER_SCIENCE.jpg", positions: [32] },
            { name: "Mozumder Aktia Pableha", country: "BANGLADESH", photo: "photos/Mozumder_Aktia_Pableha.jpg", positions: [1] },
            { name: "Bekkaoui Souhaib", country: "Morocco", photo: "photos/Bekkaoui_Souhaib.jpg", positions: [4,13,23,28,34] },
            { name: "TOURE FRED RYAN", country: "Ivory Coast", photo: "photos/TOURE_FRED_RYAN.jpg", positions: [3,11,27,32] },
            { name: "KUNGNE KALEUK STEEVE JOSUE", country: "Cameroon", photo: "photos/KUNGNE_KALEUK_STEEVE_JOSUE.jpg", positions: [1,35] },
            { name: "Naphtali Antonio", country: "", photo: "photos/Naphtali_Antonio.jpg", positions: [14] },
            { name: "Magzhan", country: "Kazakhstan", photo: "photos/Magzhan.jpg", positions: [12,21] },
            { name: "Ahmed Qahtan", country: "Yemen", photo: "photos/Ahmed_Qahtan.jpg", positions: [21] },
            { name: "Takem Tchinda Saturnin", country: "Cameroon", photo: "photos/Takem_Tchinda_Saturnin.jpg", positions: [2,7,19] },
            { name: "KHALIL", country: "RUSSIA", photo: "photos/KHALIL.jpg", positions: [4,18] },
            { name: "Kadyrova Kadiya Demirovna", country: "Kyrgyzstan", photo: "photos/Kadyrova_Kadiya_Demirovna.jpg", positions: [8,10,22,24] },
            { name: "CHAFAI ASMA", country: "MOROCCO", photo: "photos/CHAFAI_ASMA.jpg", positions: [1] },
            { name: "ANTWI ABRAHAM FORJOUR", country: "Ghana", photo: "photos/ANTWI_ABRAHAM_FORJOUR.jpg", positions: [16] },
            { name: "Sherzat Shakirbaev", country: "Kyrgyzstan", photo: "photos/Sherzat_Shakirbaev.jpg", positions: [16,19,28] }
        ];

        let currentCategoryIndex = 0;
        let votes = {};
        let votingEnded = false;
        let hasVoted = localStorage.getItem('hasVoted') === 'true';

        // Filter categories to only include those with nominees
        function getActiveCategories() {
            const activeCategories = [];
            const categoryHasCandidates = new Array(awardCategories.length).fill(false);
            
            candidates.forEach(candidate => {
                candidate.positions.forEach(position => {
                    if (position >= 0 && position < awardCategories.length) {
                        categoryHasCandidates[position] = true;
                    }
                });
            });
            
            const categoryMapping = [];
            let newIndex = 0;
            
            for (let i = 0; i < awardCategories.length; i++) {
                if (categoryHasCandidates[i]) {
                    activeCategories.push(awardCategories[i]);
                    categoryMapping[i] = newIndex;
                    newIndex++;
                } else {
                    categoryMapping[i] = -1;
                }
            }
            
            return { activeCategories, categoryMapping };
        }

        const { activeCategories, categoryMapping } = getActiveCategories();

        // Update candidate positions to match new category indices
        const updatedCandidates = candidates.map(candidate => {
            const updatedPositions = candidate.positions
                .map(oldPos => categoryMapping[oldPos])
                .filter(newPos => newPos !== -1);
            
            return {
                ...candidate,
                positions: updatedPositions
            };
        });

        // Check voting deadline and update countdown
        function checkDeadline() {
            const now = new Date().getTime();
            const timeLeft = VOTING_DEADLINE - now;

            if (timeLeft <= 0) {
                votingEnded = true;
                document.getElementById('deadlineBanner').classList.add('ended');
                document.getElementById('deadlineText').textContent = 'Voting Has Ended!';
                disableVoting();
            } else {
                // Update countdown display
                const days = Math.floor(timeLeft / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeLeft % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeLeft % (1000 * 60 * 60)) / (1000 * 60));
                
                let countdownText = '';
                if (days > 0) {
                    countdownText = `${days} day${days > 1 ? 's' : ''}, ${hours} hour${hours > 1 ? 's' : ''} remaining`;
                    if (days === 1) {
                        document.getElementById('deadlineBanner').classList.add('warning');
                    }
                } else if (hours > 0) {
                    countdownText = `${hours} hour${hours > 1 ? 's' : ''}, ${minutes} minute${minutes > 1 ? 's' : ''} remaining`;
                    document.getElementById('deadlineBanner').classList.add('warning');
                } else {
                    countdownText = `${minutes} minute${minutes > 1 ? 's' : ''} remaining`;
                    document.getElementById('deadlineBanner').classList.add('warning');
                }
                
                document.getElementById('deadlineText').textContent = countdownText;
                
                // Update every minute
                setTimeout(checkDeadline, 60000);
            }
        }

        // Disable voting when deadline passes or user has already voted
        function disableVoting() {
            const voteButtons = document.querySelectorAll('.candidate-option');
            voteButtons.forEach(button => {
                button.style.cursor = 'not-allowed';
                button.style.opacity = '0.6';
                button.onclick = null;
            });
            
            const navButtons = document.querySelectorAll('.nav-btn');
            navButtons.forEach(button => {
                button.disabled = true;
                button.style.cursor = 'not-allowed';
            });
            
            const submitBtn = document.querySelector('.submit-btn');
            if (submitBtn) {
                submitBtn.disabled = true;
            }
            
            document.querySelector('.instructions').innerHTML = 
                '<p style="color: #e74c3c;">‚ö†Ô∏è Voting has ended. Thank you for participating!</p>';
        }

        // Show already voted message
        function showAlreadyVoted() {
            document.getElementById('alreadyVotedMessage').style.display = 'block';
            document.getElementById('categoriesContainer').style.display = 'none';
            document.getElementById('submitSection').style.display = 'none';
            document.querySelector('.progress-bar').style.display = 'none';
            document.querySelector('.progress-text').style.display = 'none';
        }

        // Reset for new voter (Admin function)
        function resetForNewVoter() {
            if (votingEnded) {
                alert('Voting has ended. Cannot start new voting session.');
                return;
            }
            votes = {};
            currentCategoryIndex = 0;
            hasVoted = false;
            localStorage.removeItem('hasVoted');
            document.getElementById('submitSection').classList.remove('active');
            document.getElementById('alreadyVotedMessage').style.display = 'none';
            document.getElementById('categoriesContainer').style.display = 'block';
            document.querySelector('.progress-bar').style.display = 'block';
            document.querySelector('.progress-text').style.display = 'block';
            loadCurrentCategory();
            updateProgress();
            alert('‚úÖ Ready for new voter! Previous votes cleared.');
        }

        // Load current category
        function loadCurrentCategory() {
            if (hasVoted || votingEnded) {
                if (hasVoted) showAlreadyVoted();
                return;
            }

            const container = document.getElementById('categoriesContainer');
            const category = activeCategories[currentCategoryIndex];
            
            const categoryCandidates = updatedCandidates.filter(candidate => 
                candidate.positions.includes(currentCategoryIndex)
            );

            container.innerHTML = `
                <div class="category-container active">
                    <div class="category-title">${category}</div>
                    <div class="category-description">
                        Select ONE winner from ${categoryCandidates.length} candidate(s)
                    </div>
                    
                    <div class="candidates-grid">
                        ${categoryCandidates.map((candidate, index) => `
                            <div class="candidate-option" onclick="selectCandidate(${currentCategoryIndex}, '${candidate.name}')">
                                <img src="${candidate.photo}" alt="${candidate.name}" class="candidate-photo" 
                                     onerror="this.src='https://via.placeholder.com/120x120/3498db/white?text=Photo'">
                                <div class="candidate-name">${candidate.name}</div>
                                <div class="candidate-country">${candidate.country}</div>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="navigation">
                        <button class="nav-btn" onclick="previousCategory()" ${currentCategoryIndex === 0 ? 'disabled' : ''}>
                            ‚Üê Previous
                        </button>
                        <button class="nav-btn" onclick="nextCategory()">
                            ${currentCategoryIndex === activeCategories.length - 1 ? 'Finish' : 'Next ‚Üí'}
                        </button>
                    </div>
                </div>
            `;

            updateProgress();
            
            if (votes[currentCategoryIndex]) {
                highlightSelectedCandidate(currentCategoryIndex, votes[currentCategoryIndex]);
            }
        }

        // Select candidate for category
        function selectCandidate(categoryIndex, candidateName) {
            if (votingEnded || hasVoted) {
                alert('Voting is not allowed at this time.');
                return;
            }
            votes[categoryIndex] = candidateName;
            highlightSelectedCandidate(categoryIndex, candidateName);
            updateProgress();
        }

        // Highlight selected candidate
        function highlightSelectedCandidate(categoryIndex, candidateName) {
            const options = document.querySelectorAll('.candidate-option');
            options.forEach(option => {
                option.classList.remove('selected');
                if (option.querySelector('.candidate-name').textContent === candidateName) {
                    option.classList.add('selected');
                }
            });
        }

        // Navigation functions
        function nextCategory() {
            if (currentCategoryIndex < activeCategories.length - 1) {
                currentCategoryIndex++;
                loadCurrentCategory();
            } else {
                showSubmitSection();
            }
        }

        function previousCategory() {
            if (currentCategoryIndex > 0) {
                currentCategoryIndex--;
                loadCurrentCategory();
            }
        }

        // Update progress
        function updateProgress() {
            const votedCount = Object.keys(votes).length;
            const progress = (votedCount / activeCategories.length) * 100;
            
            document.getElementById('progressFill').style.width = `${progress}%`;
            document.getElementById('progressText').textContent = 
                `Category ${currentCategoryIndex + 1} of ${activeCategories.length} ‚Ä¢ ${votedCount}/${activeCategories.length} voted`;
        }

        // Show submit section
        function showSubmitSection() {
            document.getElementById('submitSection').classList.add('active');
        }

        // Submit votes
        async function submitVotes() {
            if (votingEnded || hasVoted) {
                alert('Voting is not allowed at this time.');
                return;
            }

            const totalVotes = Object.keys(votes).length;
            
            if (totalVotes === 0) {
                alert('Please vote in at least one category before submitting.');
                return;
            }

            let successCount = 0;
            const timestamp = new Date().toISOString();
            
            for (const [categoryIndex, candidateName] of Object.entries(votes)) {
                const success = await saveVoteToSheet(
                    activeCategories[categoryIndex], 
                    candidateName, 
                    timestamp
                );
                if (success) successCount++;
            }

            if (successCount > 0) {
                // Mark as voted to prevent re-voting
                hasVoted = true;
                localStorage.setItem('hasVoted', 'true');
                
                alert(`‚úÖ Success! ${successCount} votes submitted! Thank you for voting.`);
                showAlreadyVoted();
            } else {
                alert(`‚ö†Ô∏è Votes could not be submitted. Please check internet connection.`);
            }
        }

        // Save vote to Google Sheets
        async function saveVoteToSheet(category, candidate, timestamp) {
            const voteData = {
                category: category,
                candidate: candidate,
                timestamp: timestamp
            };
            
            try {
                const response = await fetch(GOOGLE_SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify(voteData)
                });
                return true;
            } catch (error) {
                console.error('Failed to save vote:', error);
                return false;
            }
        }

        // View All Votes (Mock function - in real implementation, you'd fetch from Google Sheets)
        function viewAllVotes() {
            const modal = document.getElementById('voteResultsModal');
            const content = document.getElementById('voteResultsContent');
            
            // Mock data - in real implementation, fetch from Google Sheets
            const mockVotes = {
                "ISU Executive Board Member of the Year": [
                    { candidate: "EL-KHADIRI MERYEME", votes: 15 },
                    { candidate: "SOT FA ELIN", votes: 8 }
                ],
                "Most Dedicated Volunteer": [
                    { candidate: "Michelle Okyerebea Asante", votes: 12 },
                    { candidate: "Izzatullaev Musulmon", votes: 10 },
                    { candidate: "PHIRI EMMANUEL", votes: 7 },
                    { candidate: "Mozumder Aktia Pableha", votes: 5 },
                    { candidate: "KUNGNE KALEUK STEEVE JOSUE", votes: 3 },
                    { candidate: "CHAFAI ASMA", votes: 2 }
                ],
                "Most Popular Award (Female)": [
                    { candidate: "EL-KHADIRI MERYEME", votes: 20 },
                    { candidate: "Michelle Okyerebea Asante", votes: 18 },
                    { candidate: "NIGINA", votes: 15 },
                    { candidate: "Karshygayeva Aiym", votes: 12 },
                    { candidate: "Kong Mengsean", votes: 8 },
                    { candidate: "Kadyrova Kadiya Demirovna", votes: 5 }
                ]
            };

            let html = '<p style="color: #7f8c8d; text-align: center; margin-bottom: 20px;">Note: This shows sample data. Real results are in Google Sheets.</p>';
            
            Object.entries(mockVotes).forEach(([category, candidates]) => {
                html += `
                    <div class="vote-category">
                        <div class="vote-category-title">${category}</div>
                        ${candidates.map((candidate, index) => `
                            <div class="vote-candidate ${index === 0 ? 'winner' : ''}">
                                ${index === 0 ? 'üèÜ ' : ''}${candidate.candidate} 
                                <span style="float: right; color: #3498db; font-weight: bold;">${candidate.votes} votes</span>
                            </div>
                        `).join('')}
                    </div>
                `;
            });

            content.innerHTML = html;
            modal.style.display = 'block';
        }

        // Close modal
        function closeModal() {
            document.getElementById('voteResultsModal').style.display = 'none';
        }

        // Clear all votes from localStorage
        function clearAllVotes() {
            if (confirm('‚ö†Ô∏è ARE YOU SURE? This will clear ALL voting data including who has voted!')) {
                localStorage.removeItem('hasVoted');
                localStorage.removeItem('isu_votes');
                votes = {};
                hasVoted = false;
                currentCategoryIndex = 0;
                loadCurrentCategory();
                updateProgress();
                alert('All voting data has been cleared!');
            }
        }

        // Extend voting deadline
        function extendDeadline() {
            const extraDays = prompt('How many extra days to extend voting?', '1');
            if (extraDays && !isNaN(extraDays)) {
                VOTING_DEADLINE = new Date(Date.now() + (VOTING_DURATION_DAYS + parseInt(extraDays)) * 24 * 60 * 60 * 1000).getTime();
                alert(`Voting extended by ${extraDays} day(s)!`);
                checkDeadline();
            }
        }

        // View voting statistics
        function viewVotingStats() {
            const totalVoters = Object.keys(JSON.parse(localStorage.getItem('isu_votes') || '{}')).length;
            const hasVotedCount = localStorage.getItem('hasVoted') ? 1 : 0;
            
            alert(`üìä Voting Statistics:\n\n‚Ä¢ Total Votes Submitted: ${totalVoters}\n‚Ä¢ Current Device Voted: ${hasVotedCount ? 'Yes' : 'No'}\n‚Ä¢ Voting Deadline: ${new Date(VOTING_DEADLINE).toLocaleString()}`);
        }

        // Admin functions
        function viewLiveResults() {
            window.open('https://docs.google.com/spreadsheets/d/1GeiFcvRSwdyUa5Xak4LjfwLA1M-6313gR0YPcpm3Hk4/edit', '_blank');
        }

        // Initialize
        window.addEventListener('load', function() {
            checkDeadline();
            loadCurrentCategory();
            updateProgress();
        });

        // Close modal when clicking outside
        window.addEventListener('click', function(event) {
            const modal = document.getElementById('voteResultsModal');
            if (event.target === modal) {
                closeModal();
            }
        });
    </script>
</body>
</html>




